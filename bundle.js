!function(){"use strict";var t=function(){function t(t,r,i){this.device=t,this.vertices=r,this.indices=i,this.indexBuffer=t.createBuffer({size:e(this.indices.byteLength),usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.indexBuffer.getMappedRange()).set(this.indices),this.indexBuffer.unmap(),this.vertexBuffer=t.createBuffer({size:e(this.vertices.byteLength),usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.vertexBuffer.getMappedRange()).set(this.vertices),this.vertexBuffer.unmap()}return t.prototype.upload=function(){this.device.queue.writeBuffer(this.vertexBuffer,0,this.vertices,0,this.vertices.length)},t}();function e(t){return t+3&-4}Math.PI,Math.PI;const r={};function i(t,{precision:e=r.precision||4}={}){return t=function(t){return Math.round(t/r.EPSILON)*r.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function n(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function s(t,e,i){const o=r.EPSILON;i&&(r.EPSILON=i);try{if(t===e)return!0;if(n(t)&&n(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!s(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{r.EPSILON=o}}function o(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}r.EPSILON=1e-12,r.debug=!1,r.precision=4,r.printTypes=!1,r.printDegrees=!1,r.printRowMajor=!0;class h extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return o(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}to(t){return t===this?this:n(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(r)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+i(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!s(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){void 0===r&&(r=e,e=t,t=this);for(let i=0;i<this.ELEMENTS;++i){const n=t[i];this[i]=n+r*(e[i]-n)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(r.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function a(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function u(t,e,i=""){if(r.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(i," some fields set to invalid numbers'"));return t}const c={};function f(t,e){c[t]||(c[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}class l extends h{get ELEMENTS(){return o(!1),0}copy(t){return o(!1),this}get x(){return this[0]}set x(t){this[0]=a(t)}get y(){return this[1]}set y(t){this[1]=a(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-t[r];e+=i*i}return a(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return a(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return o(t>=0&&t<this.ELEMENTS,"index is out of range"),a(this[t])}setComponent(t,e){return o(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var d,p=1e-6,m="undefined"!=typeof Float32Array?Float32Array:Array;function g(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,t}function y(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s||1;return t[0]=(r[0]*i+r[4]*n+r[8]*s)/o,t[1]=(r[1]*i+r[5]*n+r[9]*s)/o,t[2]=(r[2]*i+r[6]*n+r[10]*s)/o,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),d=new m(3),m!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0);const v=[0,0,0],E={};class M extends l{static get ZERO(){return E.ZERO=E.ZERO||Object.freeze(new M(0,0,0,0))}constructor(t=0,e=0,i=0){super(-0,-0,-0),1===arguments.length&&n(t)?this.copy(t):(r.debug&&(a(t),a(e),a(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return r.debug&&(a(t.x),a(t.y),a(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=a(t)}angle(t){return r=t,i=(e=this)[0],n=e[1],s=e[2],o=r[0],h=r[1],a=r[2],c=(u=Math.sqrt(i*i+n*n+s*s)*Math.sqrt(o*o+h*h+a*a))&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(e,r)/u,Math.acos(Math.min(Math.max(c,-1),1));var e,r,i,n,s,o,h,a,u,c}cross(t){return function(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[0],h=r[1],a=r[2];t[0]=n*a-s*h,t[1]=s*o-i*a,t[2]=i*h-n*o}(this,this,t),this.check()}rotateX({radians:t,origin:e=v}){return function(t,e,r,i){var n=[],s=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=v}){return function(t,e,r,i){var n=[],s=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=v}){return function(t,e,r,i){var n=[],s=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return g(this,this,t),this.check()}transformAsVector(t){return y(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,r){var i=e[0],n=e[1],s=e[2];t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){const i=e[0],n=e[1];t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return function(t,e,r){var i=r[0],n=r[1],s=r[2],o=r[3],h=e[0],a=e[1],u=e[2],c=n*u-s*a,f=s*h-i*u,l=i*a-n*h,d=n*l-s*f,p=s*c-i*l,m=i*f-n*c,g=2*o;c*=g,f*=g,l*=g,d*=2,p*=2,m*=2,t[0]=h+c+d,t[1]=a+f+p,t[2]=u+l+m}(this,this,t),this.check()}}class w extends h{get ELEMENTS(){return o(!1),0}get RANK(){return o(!1),0}toString(){let t="[";if(r.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=a(r),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[r+t];return e}setColumn(t,e){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)this[r+t]=e[t];return this}}function b(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3],h=e[4],a=e[5],u=e[6],c=e[7],f=e[8],l=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],v=e[15],E=r[0],M=r[1],w=r[2],b=r[3];return t[0]=E*i+M*h+w*f+b*m,t[1]=E*n+M*a+w*l+b*g,t[2]=E*s+M*u+w*d+b*y,t[3]=E*o+M*c+w*p+b*v,E=r[4],M=r[5],w=r[6],b=r[7],t[4]=E*i+M*h+w*f+b*m,t[5]=E*n+M*a+w*l+b*g,t[6]=E*s+M*u+w*d+b*y,t[7]=E*o+M*c+w*p+b*v,E=r[8],M=r[9],w=r[10],b=r[11],t[8]=E*i+M*h+w*f+b*m,t[9]=E*n+M*a+w*l+b*g,t[10]=E*s+M*u+w*d+b*y,t[11]=E*o+M*c+w*p+b*v,E=r[12],M=r[13],w=r[14],b=r[15],t[12]=E*i+M*h+w*f+b*m,t[13]=E*n+M*a+w*l+b*g,t[14]=E*s+M*u+w*d+b*y,t[15]=E*o+M*c+w*p+b*v,t}function S(t,e,r){var i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}!function(){var t=new m(2);m!=Float32Array&&(t[0]=0,t[1]=0)}(),function(){var t=new m(4);m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();const O=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),x=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),L=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),N={};class A extends w{static get IDENTITY(){return N.IDENTITY=N.IDENTITY||Object.freeze(new A(O)),N.IDENTITY}static get ZERO(){return N.ZERO=N.ZERO||Object.freeze(new A(x)),N.ZERO}get INDICES(){return L}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,i,n,s,o,h,a,u,c,f,l,d,p,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=i,this[4]=n,this[5]=s,this[6]=o,this[7]=h,this[8]=a,this[9]=u,this[10]=c,this[11]=f,this[12]=l,this[13]=d,this[14]=p,this[15]=m,this.check()}setRowMajor(t,e,r,i,n,s,o,h,a,u,c,f,l,d,p,m){return this[0]=t,this[1]=n,this[2]=a,this[3]=l,this[4]=e,this[5]=s,this[6]=u,this[7]=d,this[8]=r,this[9]=o,this[10]=c,this[11]=p,this[12]=i,this[13]=h,this[14]=f,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(O)}fromQuaternion(t){return function(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,h=i+i,a=n+n,u=r*o,c=i*o,f=i*h,l=n*o,d=n*h,p=n*a,m=s*o,g=s*h,y=s*a;t[0]=1-f-p,t[1]=c+y,t[2]=l-g,t[3]=0,t[4]=c-y,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=l+g,t[9]=d-m,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum({left:t,right:e,bottom:r,top:i,near:n,far:s}){return s===1/0?A._computeInfinitePerspectiveOffCenter(this,t,e,r,i,n):function(t,e,r,i,n,s,o){var h=1/(r-e),a=1/(n-i),u=1/(s-o);t[0]=2*s*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*a,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+i)*a,t[10]=(o+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*u,t[15]=0}(this,t,e,r,i,n,s),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,r,i,n,s){const o=2*s/(r-e),h=2*s/(n-i),a=(r+e)/(r-e),u=(n+i)/(n-i),c=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=a,t[9]=u,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=c,t[15]=0,t}lookAt(t,e,r){return 1===arguments.length&&({eye:t,center:e,up:r}=t),function(t,e,r,i){var n,s,o,h,a,u,c,f,l,d,m=e[0],g=e[1],y=e[2],v=i[0],E=i[1],M=i[2],w=r[0],b=r[1],S=r[2];Math.abs(m-w)<p&&Math.abs(g-b)<p&&Math.abs(y-S)<p?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(c=m-w,f=g-b,l=y-S,n=E*(l*=d=1/Math.hypot(c,f,l))-M*(f*=d),s=M*(c*=d)-v*l,o=v*f-E*c,(d=Math.hypot(n,s,o))?(n*=d=1/d,s*=d,o*=d):(n=0,s=0,o=0),h=f*o-l*s,a=l*n-c*o,u=c*s-f*n,(d=Math.hypot(h,a,u))?(h*=d=1/d,a*=d,u*=d):(h=0,a=0,u=0),t[0]=n,t[1]=h,t[2]=c,t[3]=0,t[4]=s,t[5]=a,t[6]=f,t[7]=0,t[8]=o,t[9]=u,t[10]=l,t[11]=0,t[12]=-(n*m+s*g+o*y),t[13]=-(h*m+a*g+u*y),t[14]=-(c*m+f*g+l*y),t[15]=1)}(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:r,top:i,near:n=.1,far:s=500}){return function(t,e,r,i,n,s,o){var h=1/(e-r),a=1/(i-n),u=1/(s-o);t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+i)*a,t[14]=(o+s)*u,t[15]=1}(this,t,e,r,i,n,s),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:r=1,near:i=.1,far:n=500}){if(t>2*Math.PI)throw Error("radians");const s=t/2,o=r*Math.tan(s),h=o*e;return(new A).ortho({left:-h,right:h,bottom:-o,top:o,near:i,far:n})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:r=1,near:i=.1,far:n=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return function(t,e,r,i,n){var s,o=1/Math.tan(e/2);t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(i-n),t[10]=(n+i)*s,t[14]=2*n*i*s):(t[10]=-1,t[14]=-2*i)}(this,t,r,i,n),this.check()}determinant(){return e=(t=this)[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],h=t[6],a=t[7],u=t[8],c=t[9],f=t[10],l=t[11],d=t[12],p=t[13],m=t[14],(e*o-r*s)*(f*(g=t[15])-l*m)-(e*h-i*s)*(c*g-l*p)+(e*a-n*s)*(c*m-f*p)+(r*h-i*o)*(u*g-l*d)-(r*a-n*o)*(u*m-f*d)+(i*a-n*h)*(u*p-c*d);var t,e,r,i,n,s,o,h,a,u,c,f,l,d,p,m,g}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),i=1/r[0],n=1/r[1],s=1/r[2];return t[0]=this[0]*i,t[1]=this[1]*n,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*n,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*n,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),i=1/r[0],n=1/r[1],s=1/r[2];return t[0]=this[0]*i,t[1]=this[1]*n,t[2]=this[2]*s,t[3]=this[4]*i,t[4]=this[5]*n,t[5]=this[6]*s,t[6]=this[8]*i,t[7]=this[9]*n,t[8]=this[10]*s,t}transpose(){return function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],h=e[5],a=e[6],u=e[7],c=e[8],f=e[9],l=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],v=r*h-i*o,E=r*a-n*o,M=r*u-s*o,w=i*a-n*h,b=i*u-s*h,S=n*u-s*a,O=c*m-f*p,x=c*g-l*p,L=c*y-d*p,N=f*g-l*m,A=f*y-d*m,P=l*y-d*g,T=v*P-E*A+M*N+w*L-b*x+S*O;T&&(T=1/T,t[0]=(h*P-a*A+u*N)*T,t[1]=(n*A-i*P-s*N)*T,t[2]=(m*S-g*b+y*w)*T,t[3]=(l*b-f*S-d*w)*T,t[4]=(a*L-o*P-u*x)*T,t[5]=(r*P-n*L+s*x)*T,t[6]=(g*M-p*S-y*E)*T,t[7]=(c*S-l*M+d*E)*T,t[8]=(o*A-h*L+u*O)*T,t[9]=(i*L-r*A-s*O)*T,t[10]=(p*b-m*M+y*v)*T,t[11]=(f*M-c*b-d*v)*T,t[12]=(h*x-o*N-a*O)*T,t[13]=(r*N-i*x+n*O)*T,t[14]=(m*E-p*w-g*v)*T,t[15]=(c*w-f*E+l*v)*T)}(this,this),this.check()}multiplyLeft(t){return b(this,t,this),this.check()}multiplyRight(t){return b(this,this,t),this.check()}rotateX(t){return function(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],h=e[6],a=e[7],u=e[8],c=e[9],f=e[10],l=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+u*i,t[5]=o*n+c*i,t[6]=h*n+f*i,t[7]=a*n+l*i,t[8]=u*n-s*i,t[9]=c*n-o*i,t[10]=f*n-h*i,t[11]=l*n-a*i}(this,this,t),this.check()}rotateY(t){return function(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],h=e[2],a=e[3],u=e[8],c=e[9],f=e[10],l=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-u*i,t[1]=o*n-c*i,t[2]=h*n-f*i,t[3]=a*n-l*i,t[8]=s*i+u*n,t[9]=o*i+c*n,t[10]=h*i+f*n,t[11]=a*i+l*n}(this,this,t),this.check()}rotateZ(t){return function(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],h=e[2],a=e[3],u=e[4],c=e[5],f=e[6],l=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+u*i,t[1]=o*n+c*i,t[2]=h*n+f*i,t[3]=a*n+l*i,t[4]=u*n-s*i,t[5]=c*n-o*i,t[6]=f*n-h*i,t[7]=l*n-a*i}(this,this,t),this.check()}rotateXYZ([t,e,r]){return this.rotateX(t).rotateY(e).rotateZ(r)}rotateAxis(t,e){return function(t,e,r,i){var n,s,o,h,a,u,c,f,l,d,m,g,y,v,E,M,w,b,S,O,x,L,N,A,P=i[0],T=i[1],R=i[2],k=Math.hypot(P,T,R);k<p||(P*=k=1/k,T*=k,R*=k,n=Math.sin(r),o=1-(s=Math.cos(r)),h=e[0],a=e[1],u=e[2],c=e[3],f=e[4],l=e[5],d=e[6],m=e[7],g=e[8],y=e[9],v=e[10],E=e[11],M=P*P*o+s,w=T*P*o+R*n,b=R*P*o-T*n,S=P*T*o-R*n,O=T*T*o+s,x=R*T*o+P*n,L=P*R*o+T*n,N=T*R*o-P*n,A=R*R*o+s,t[0]=h*M+f*w+g*b,t[1]=a*M+l*w+y*b,t[2]=u*M+d*w+v*b,t[3]=c*M+m*w+E*b,t[4]=h*S+f*O+g*x,t[5]=a*S+l*O+y*x,t[6]=u*S+d*O+v*x,t[7]=c*S+m*O+E*x,t[8]=h*L+f*N+g*A,t[9]=a*L+l*N+y*A,t[10]=u*L+d*N+v*A,t[11]=c*L+m*N+E*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?S(this,this,t):S(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,r){var i,n,s,o,h,a,u,c,f,l,d,p,m=r[0],g=r[1],y=r[2];e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[0],n=e[1],s=e[2],o=e[3],h=e[4],a=e[5],u=e[6],c=e[7],f=e[8],l=e[9],d=e[10],p=e[11],t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=h,t[5]=a,t[6]=u,t[7]=c,t[8]=f,t[9]=l,t[10]=d,t[11]=p,t[12]=i*m+h*g+f*y+e[12],t[13]=n*m+a*g+l*y+e[13],t[14]=s*m+u*g+d*y+e[14],t[15]=o*m+c*g+p*y+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=function(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}(e||[-0,-0,-0,-0],t,this),u(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;switch(r){case 2:e=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}(e||[-0,-0],t,this);break;case 3:e=g(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return u(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=function(t,e,r){const i=e[0],n=e[1],s=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/s,t[1]=(r[1]*i+r[5]*n)/s,t}(e||[-0,-0],t,this);break;case 3:e=y(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return u(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}transformPoint(t,e){return f("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return f("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return f("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}var P=function(){function t(t,e,r,i){this.device=t,this.geometry=e,this._position=r||new M(0,0,0),this._rotation=i||new M(0,0,0),this.updated=!!r||!!i,this.renderPipeline=null}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.updated=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this.updated=!0},enumerable:!1,configurable:!0}),t.prototype.getRenderPipeline=function(t){if(this.renderPipeline)return this.updateUniforms(),this.renderPipeline;var e,r=this.device.createShaderModule({code:"struct Output {\n    @builtin(position) Position: vec4<f32>,\n    @location(0) Normal: vec3<f32>,\n};\n\nstruct Camera {\n    projection: mat4x4<f32>,\n    view: mat4x4<f32>,\n};\n\n@group(0) @binding(0) var<uniform> camera: Camera;\n@group(1) @binding(0) var<uniform> model: mat4x4<f32>;\n\n@stage(vertex)\nfn main(@location(0) position: vec3<f32>, @location(1) normal: vec3<f32>) -> Output {\n    var output: Output;\n\n    output.Normal = normal;\n    output.Position = camera.projection * camera.view * model * vec4<f32>(position, 1.0);\n\n    return output;\n}\n"}),i=this.device.createShaderModule({code:"@stage(fragment)\nfn main(@location(0) normal: vec3<f32>) -> @location(0) vec4<f32> {\n    return vec4<f32>(normal, 1.0);\n}\n"}),n=this.computeUniform();this.uniformBuffer=this.device.createBuffer({size:(e=n.byteLength,e+3&-4),usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),new Float32Array(this.uniformBuffer.getMappedRange()).set(n),this.uniformBuffer.unmap();var s=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});this.uniformBindGroup=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});var o=this.device.createPipelineLayout({bindGroupLayouts:[t.uniformBindGroupLayout,s]});return this.renderPipeline=this.device.createRenderPipeline({layout:o,vertex:{module:r,entryPoint:"main",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}],arrayStride:24,stepMode:"vertex"}]},fragment:{module:i,entryPoint:"main",targets:[{format:"bgra8unorm"}]},primitive:{frontFace:"cw",cullMode:"none",topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}}),this.renderPipeline},t.prototype.updateUniforms=function(){var t=this.computeUniform();this.device.queue.writeBuffer(this.uniformBuffer,0,t,0,t.length)},t.prototype.computeUniform=function(){return(new A).translate(this.position).rotateXYZ(this.rotation).toFloat32Array()},t}(),T=function(){return T=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},T.apply(this,arguments)},R=function(){function t(t,e){var r=this;this.device=t,this.config=T({fovy:Math.PI/4,near:.1,far:1e3},e),this.distance=5,this.position=new M(0,0,-this.distance),this.rotation=new M(k(90),0,0),this.dragging=!1,this.rotateX=this.rotation.x,this.rotateY=this.rotation.y,this.x=0,this.y=0,this.lastX=0,this.lastY=0,this.limitX=85,this.uniformBuffer=t.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.uniformBindGroupLayout=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),this.uniformBindGroup=t.createBindGroup({layout:this.uniformBindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]}),window.addEventListener("mousedown",(function(){return r.onMouseButtonPressed()})),window.addEventListener("mouseup",(function(){return r.onMouseButtonReleased()})),window.addEventListener("wheel",(function(t){return r.onMouseWheel(t.deltaY)})),window.addEventListener("mousemove",(function(t){return r.onMouseMove(t.clientX,t.clientY)})),this.updateUniform()}return t.prototype.onMouseButtonPressed=function(){this.dragging=!0,this.lastX=this.x,this.lastY=this.y},t.prototype.onMouseButtonReleased=function(){this.dragging=!1},t.prototype.onMouseMove=function(t,e){this.x=t,this.y=e,this.dragging&&this.drag(this.x,this.y)},t.prototype.onMouseWheel=function(t){this.distance+=.5*t,this.position=new M(0,0,-this.distance),this.updateUniform()},t.prototype.drag=function(t,e){var r=90/this.config.height,i=180/this.config.width,n=this.rotateX+r*(e-this.lastY),s=this.rotateY+i*(t-this.lastX);(n<-this.limitX||n>this.limitX)&&(n=this.limitX),this.lastX=t,this.lastY=e,(Math.abs(n-this.rotateX)>.01||Math.abs(s-this.rotateY)>.01)&&(this.rotateX=n,this.rotateY=s,this.position=new M(0,0,-this.distance),this.rotation=new M(k(this.rotateX),k(this.rotateY),0)),this.updateUniform()},t.prototype.updateUniform=function(){var t=(new A).perspective({fovy:this.config.fovy,near:this.config.near,far:this.config.far,aspect:this.config.width/this.config.height}),e=(new A).translate(this.position).rotateXYZ(this.rotation),r=new Float32Array(32);r.set(t.toArray(),0),r.set(e.toArray(),16),this.device.queue.writeBuffer(this.uniformBuffer,0,r,0,r.length)},t}();function k(t){return t*(Math.PI/180)}var B=function(){function t(t,e){this.device=e,this.context=t.getContext("webgpu"),this.context.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,compositingAlphaMode:"opaque"});var r={size:[t.width,t.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC},i=this.device.createTexture(r);this.depthTextureView=i.createView()}return t.prototype.render=function(t,e,r){var i={colorAttachments:[{view:this.context.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:.83,g:.85,b:.86,a:1},storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:0,stencilLoadOp:"clear",stencilStoreOp:"store"}},n=this.device.createCommandEncoder(),s=n.beginRenderPass(i),o=this.context.canvas,h=o.width,a=o.height;s.setPipeline(e),s.setViewport(0,0,h,a,0,1),s.setScissorRect(0,0,h,a),s.setVertexBuffer(0,t.vertexBuffer),s.setIndexBuffer(t.indexBuffer,"uint16");for(var u=0;u<r.length;u++)s.setBindGroup(u,r[u]);s.drawIndexed(t.indices.length),s.end(),this.device.queue.submit([n.finish()])},t}(),C=function(){function t(){}return t.prototype.solve=function(t,e){},t}(),I=function(){function e(e,r){this.canvas=e,this.device=r,this.stopped=!1;var i=function(e,r,i,n,s){for(var o=new Float32Array(150),h=new Uint16Array(96),a=0,u=0,c=0;c<=4;c++)for(var f=0;f<=4;f++){var l=[1*f,0,1*c,0,1,0];if(o.set(l,a),a+=6,0!=c){var d=f+5*c;f>0&&(h.set([d-5,d-1,d],u),u+=3),f<4&&(h.set([d-5,d,d-4],u),u+=3)}}return new t(e,o,h)}(r);this.cloth=new P(r,i,new M(-2,0,-2)),this.camera=new R(r,{width:e.width,height:e.height}),this.renderer=new B(e,r),this.solver=new C}return e.prototype.run=function(){return t=this,e=void 0,i=function(){var t,e=this;return function(t,e){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}}(this,(function(r){return this.stopped=!1,t=Date.now(),[2,new Promise((function(r,i){var n=function(i){if(e.stopped)r();else{var s=i-t;t=i,e.solver.solve(s,e.cloth);var o=e.cloth.getRenderPipeline(e.camera);e.renderer.render(e.cloth.geometry,o,[e.camera.uniformBindGroup,e.cloth.uniformBindGroup]),window.requestAnimationFrame(n)}};window.requestAnimationFrame(n)}))]}))},new((r=void 0)||(r=Promise))((function(n,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function h(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}a((i=i.apply(t,e||[])).next())}));var t,e,r,i},e.prototype.stop=function(){this.stopped=!0},e}();(function(){return t=this,e=void 0,i=function(){var t,e,r;return function(t,e){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}}(this,(function(i){switch(i.label){case 0:if(!(t=navigator.gpu))throw new Error("WebGPU is not supported on this browser.");return[4,t.requestAdapter()];case 1:return[4,i.sent().requestDevice()];case 2:return e=i.sent(),(r=document.getElementById("app")).width=800,r.height=500,[2,new I(r,e).run()]}}))},new((r=void 0)||(r=Promise))((function(n,s){function o(t){try{a(i.next(t))}catch(t){s(t)}}function h(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,h)}a((i=i.apply(t,e||[])).next())}));var t,e,r,i})().then((function(){return console.log("done")})).catch((function(t){return console.error(t)}))}();